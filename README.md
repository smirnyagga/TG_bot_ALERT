# TG_bot_alerts

Написано на Python с использованием асинхронной библиотеки Aiogram, библиотеки APScheduler и встраиваемой СУБД SQLite.

## Description

Бот отправляет в контролируемые чаты утром и вечером в заданное время приветственные сообщения из заданного списка. 
В ночное время, с ночным сообщением чаты выключается и доступны для сообщений только от администраторов. 
С утренним сообщением чаты открывается вновь.

Бот начинает работу и определяет старшего администратора __(СА)__ с первой команды __/start__.
СА добавляет и удаляет чаты, в которых будет работать бот, определет администраторов (модератор, другой администратор (в дальнейшем - __(ДА)__)). 

При добавлении чата сразу требуется ввести id ДА. Именно ДА будет доступно изменение времени и сообщений в заданном чате.
СА так же может ввести свое id, чтобы управлять чатами. 

При добавлении чата в него в БД добавляется время и сообщения по умолчанию. 6:30 - утреннеее время. 22:30 - ночное время. Бот работает 
с данными по умолчанию, до тех пор, пока ДА не изменит данные.

-___Бот должен быть администратором в чате, в котором будет работать.___

-___СА должен быть администратором во всех чатах, которые собирается контролировать.___

-___У каждого чата может быть только один ДА. Но один пользователь может быть модератором в разных чатах___

-___Общение с ботом происходит через личные сообщения.___

-___При миграции группы в супергруппу и изменении id, происходит автоматическая замена в БД и scheduler на новый id.___

-___При добавлении бота в группу СА приходит уведомление с id чата, чтобы избежать добавления сторонних ботов для поиска id.___

-___Чтобы бот перестал работать в чате, нужно удалить его из чата или СА должен удалить id чата из данных бота.___

## Сommands

___ОБЩИЕ КОМАНДЫ___

__/start__

При срабатывании первый раз, определяет пользователя как CA.

В следующий раз распознает СА как СА.

Если вводит не СА-проверяет, есть ли пользователь в списке других администраторов (ДА).
Если на в каком списке нет-прощается.

__/help__

Выводит доступные команды СА или ДА. Другим пользователям не выводит.

___КОМАНДЫ СТАРШЕГО АДМИНИСТРАТОРА___

__/chats__ 

Посмотреть список всех чатов, в которых сейчас работает бот.

__/add_chat__ 

Добавить новый чат с администратором для работы бота.

__/del_chat__ 

Удалить чат из списка для работы бота.

__/change_admin__ - Изменить администратора в уже добавленном чате.

___КОМАНДЫ ДРУГИХ АДМИНИСТРАТОРОВ (МОДЕРАТОРОВ ЧАТА)___

__/time__

Изменение времени. Сразу утро и вечер вместе.

__/morning__

Изменение утренних сообщений.

1.___/del___ - Удалить одно

2.___/one___ - Изменить одно

3.___/add___ - Добавить одно

4.___/all___ -  Перезаписать сразу все

__/night__

Изменение ночных сообщений. 

1.___/del___ - Удалить одно

2.___/one___ - Изменить одно

3.___/add___ - Добавить одно

4.___/all___ -  Перезаписать сразу все

__/cancel__

В любой стадии выходит из меню изменения. Так же принимает текстом - отмена.

## Preparation
Переименовывать файл env.example в .env

Редактировать любым текстовым редактором и вставить свой TOKEN, сохранить.


## Starting

```
docker-compose up --build
```



